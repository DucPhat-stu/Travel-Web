{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>{{ tour.name }} - Tour Details</title>
    <meta name="description" content="{{ tour.description }}" />
    <meta name="keywords" content="tour, {{ tour.location }}, travel" />

    <!-- Favicons -->
    <link href="{% static 'img/favicon.png' %}" rel="icon" />
    <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}"
      rel="stylesheet"
    />
    <link
      href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}"
      rel="stylesheet"
    />
    <link href="{% static 'vendor/aos/aos.css' %}" rel="stylesheet" />
    <link
      href="{% static 'vendor/swiper/swiper-bundle.min.css' %}"
      rel="stylesheet"
    />
    <link
      href="{% static 'vendor/glightbox/css/glightbox.min.css' %}"
      rel="stylesheet"
    />

    <!-- Main CSS File -->
    <link href="{% static 'css/main.css' %}" rel="stylesheet" />
    <style>
      /* Set hero background via template to avoid inline attribute parsing issues */
      .page-title.dark-background {
        background-image: url({% if tour.image %}{{ tour.image.url }}{% else %}{% static 'img/travel/showcase-8.webp' %}{% endif %});
      }
    </style>
  </head>

  <body class="tour-details-page">
    <header id="header" class="header d-flex align-items-center fixed-top">
      <div
        class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between"
      >
        <a
          href="{% url 'core:home' %}"
          class="logo d-flex align-items-center me-auto me-xl-0"
        >
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <!-- <img src="{% static 'img/logo.webp' %}" alt=""> -->
          <h1 class="sitename">Tour</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="{% url 'core:home' %}">Home</a></li>
            <li><a href="{% url 'core:about' %}">About</a></li>
            <li><a href="{% url 'core:destinations' %}">Destinations</a></li>
            <li><a href="{% url 'tours:tour_list' %}">Tours</a></li>
            <li><a href="{% url 'core:gallery' %}">Gallery</a></li>
            <li><a href="{% url 'core:blog' %}">Blog</a></li>
            <li class="dropdown">
              <a href="#"
                ><span>More Pages</span>
                <i class="bi bi-chevron-down toggle-dropdown"></i
              ></a>
              <ul>
                <li>
                  <a href="{% url 'core:destinations' %}">Destination Details</a>
                </li>
                <li>
                  <a href="{% url 'tours:tour_list' %}" class="active">Tour Details</a>
                </li>
                <li><a href="{% url 'bookings:booking_list' %}">Booking</a></li>
                <li><a href="{% url 'core:testimonials' %}">Testimonials</a></li>
                <li><a href="{% url 'core:faq' %}">Frequently Asked Questions</a></li>
                <li><a href="{% url 'core:blog' %}">Blog Details</a></li>
                <li><a href="{% url 'core:terms' %}">Terms</a></li>
                <li><a href="{% url 'core:privacy' %}">Privacy</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#"
                ><span>Other amenities</span>
                <i class="bi bi-chevron-down toggle-dropdown"></i
              ></a>
              <ul>
                <li><a href="{% url 'flight:flight_list' %}">Flight</a></li>
                <li><a href="{% url 'chatbot:chatbot' %}">Chatbot</a></li>
              </ul>
            </li>
            <li><a href="{% url 'core:contact' %}">Contact</a></li>
          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

        {% if user.is_authenticated %}
            <a class="btn-getstarted" href="{% url 'users:logout' %}">log out</a>
        {% else %}
            <a class="btn-getstarted" href="{% url 'users:login' %}">log in</a>
        {% endif %}
      </div>
    </header>

    <main class="main">
      <!-- Page Title -->
      <div class="page-title dark-background" data-aos="fade">
        <div class="container position-relative">
          <h1>{{ tour.name }}</h1>
          <p>
            {{ tour.description|truncatewords:30 }}
          </p>
          <nav class="breadcrumbs">
            <ol>
              <li><a href="{% url 'core:home' %}">Home</a></li>
              <li><a href="{% url 'tours:tour_list' %}">Tours</a></li>
              <li class="current">{{ tour.name }}</li>
            </ol>
          </nav>
        </div>
      </div>
      <!-- End Page Title -->

      <!-- Travel Tour Details Section -->
      <section id="travel-tour-details" class="travel-tour-details section">
        <div class="container" data-aos="fade-up" data-aos-delay="100">
          <!-- Hero Section -->
          <div class="tour-hero">
            <div class="hero-image-wrapper">
              <img
                src="{% if tour.image %}{{ tour.image.url }}{% else %}{% static 'img/travel/showcase-9.webp' %}{% endif %}"
                alt="{{ tour.name }}"
                class="img-fluid w-100"
              />
              <div class="hero-overlay">
                <div class="hero-content">
                  <h1>{{ tour.name }}</h1>
                  <div class="hero-meta">
                    <span class="duration"
                      ><i class="bi bi-calendar"></i> {{ tour.duration }} Days</span
                    >
                    <span class="destination"
                      ><i class="bi bi-geo-alt"></i> {{ tour.location }}</span
                    >
                    <span class="rating"
                      ><i class="bi bi-star-fill"></i> 4.8 (124 reviews)</span
                    >
                  </div>
                  <p class="hero-tagline">
                    {{ tour.description|truncatewords:20 }}
                  </p>
                  <div class="hero-buttons">
                    <a href="#booking" class="btn-book">Check Availability</a>
                    {% if user.is_authenticated %}
                    <form action="{% url 'bookings:create_ticket_from_tour' %}" method="post" class="d-inline">
                      {% csrf_token %}
                      <input type="hidden" name="tour_id" value="{{ tour.tour_id }}">
                      <input type="hidden" name="number_of_people" value="1">
                      <input type="hidden" name="email" value="{{ user.email }}">
                      <input type="hidden" name="email" value="{{ user.email }}">
                      <button type="submit" class="btn-book-primary">
                        <i class="bi bi-calendar-check"></i> Book Now - ${{ tour.price }}
                      </button>
                    </form>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tour Overview -->
          <div class="tour-overview" data-aos="fade-up" data-aos-delay="200">
            <div class="row">
              <div class="col-lg-8">
                <h2>Tour Overview</h2>
                <p>{{ tour.description }}</p>
              </div>
              <div class="col-lg-4">
                <div class="tour-highlights">
                  <h3>Tour Highlights</h3>
                  <ul>
                    <li>
                      <i class="bi bi-check-circle"></i> Duration: {{ tour.duration }} days
                    </li>
                    <li>
                      <i class="bi bi-check-circle"></i> Location: {{ tour.location }}
                    </li>
                    <li>
                      <i class="bi bi-check-circle"></i> Price: ${{ tour.price }}
                    </li>
                    <li>
                      <i class="bi bi-check-circle"></i> Professional guides
                    </li>
                    <li>
                      <i class="bi bi-check-circle"></i> All-inclusive experience
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Itinerary -->
          <div class="tour-itinerary" data-aos="fade-up" data-aos-delay="300">
            <h2>Tour Itinerary</h2>
            <div class="itinerary-timeline">
              <div class="itinerary-item">
                <div class="day-number">Day 1-{{ tour.duration }}</div>
                <div class="day-content">
                  <h4>{{ tour.name }}</h4>
                  <p>
                    Enjoy a comprehensive tour of {{ tour.location }} with professional guides and all-inclusive experiences.
                  </p>
                  <div class="day-details">
                    <span class="accommodation"
                      ><i class="bi bi-building"></i> Premium Accommodations</span
                    >
                    <span class="meals"
                      ><i class="bi bi-cup-hot"></i> Meals Included</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Inclusions -->
          <div class="tour-inclusions" data-aos="fade-up" data-aos-delay="400">
            <div class="row">
              <div class="col-lg-6">
                <div class="included-section">
                  <h3>
                    <i class="bi bi-check-circle-fill"></i> What's Included
                  </h3>
                  <ul class="inclusion-list included">
                    <li>
                      <i class="bi bi-check"></i> Professional English-speaking guides
                    </li>
                    <li>
                      <i class="bi bi-check"></i> Premium accommodations
                    </li>
                    <li>
                      <i class="bi bi-check"></i> Daily breakfast
                    </li>
                    <li>
                      <i class="bi bi-check"></i> All entrance fees
                    </li>
                    <li>
                      <i class="bi bi-check"></i> Transportation
                    </li>
                    <li>
                      <i class="bi bi-check"></i> Welcome and farewell dinners
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="excluded-section">
                  <h3><i class="bi bi-x-circle-fill"></i>What's Not Included</h3>
                  <ul class="inclusion-list excluded">
                    <li>
                      <i class="bi bi-x"></i> International flights
                    </li>
                    <li>
                      <i class="bi bi-x"></i> Lunch and dinner (except specified)
                    </li>
                    <li><i class="bi bi-x"></i> Personal expenses</li>
                    <li>
                      <i class="bi bi-x"></i> Travel insurance (recommended)
                    </li>
                    <li>
                      <i class="bi bi-x"></i> Gratuities
                    </li>
                    <li>
                      <i class="bi bi-x"></i> Optional activities
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Pricing -->
          <div class="tour-pricing" data-aos="fade-up" data-aos-delay="500">
            <h2>Pricing &amp; Dates</h2>
            <div class="pricing-table">
              <div class="pricing-header">
                <div class="price-item">
                  <h3>Starting from</h3>
                  <div class="price-amount">${{ tour.price }}</div>
                  <p>per person (double room)</p>
                </div>
              </div>
              <div class="pricing-details">
                <div class="row">
                  <div class="col-lg-4">
                    <div class="price-type">
                      <h4>Double Room</h4>
                      <div class="price">${{ tour.price }}</div>
                      <p>per person</p>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="price-type">
                      <h4>Single Supplement</h4>
                      <div class="price">+$150</div>
                      <p>additional</p>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="price-type">
                      <h4>Group Discount</h4>
                      <div class="price">-$50</div>
                      <p>for 6+ people</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="available-dates">
                <h3>Available Departure Dates 2024</h3>
                <div class="dates-grid">
                  <div class="date-option">
                    <div class="date">May 15-{{ tour.duration|add:14 }}</div>
                    <div class="availability">Available</div>
                  </div>
                  <div class="date-option">
                    <div class="date">June 12-{{ tour.duration|add:11 }}</div>
                    <div class="availability">Available</div>
                  </div>
                  <div class="date-option">
                    <div class="date">July 10-{{ tour.duration|add:10 }}</div>
                    <div class="availability">Available</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Booking Form -->
          {% if user.is_authenticated %}
          <div
            class="booking-section"
            id="booking"
            data-aos="fade-up"
            data-aos-delay="600"
          >
            <div class="booking-card">
              <h2>Book Tour</h2>
              <form
                action="{% url 'bookings:create_ticket_from_tour' %}"
                method="post"
              >
              {% csrf_token %}
              <input type="hidden" name="tour_id" value="{{ tour.tour_id }}">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="travel-date">Preferred Travel Date</label>
                      <select
                        name="date"
                        id="travel-date"
                        class="form-control"
                        required=""
                      >
                        <option value="">Select a date</option>
                        <option value="May 15-{{ tour.duration|add:14 }}">May 15-{{ tour.duration|add:14 }}, 2024</option>
                        <option value="June 12-{{ tour.duration|add:11 }}">June 12-{{ tour.duration|add:11 }}, 2024</option>
                        <option value="July 10-{{ tour.duration|add:10 }}">July 10-{{ tour.duration|add:10 }}, 2024</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="travelers">Number of Travelers</label>
                      <select
                        name="number_of_people"
                        id="travelers"
                        class="form-control"
                        required=""
                      >
                        <option value="">Select travelers</option>
                        <option value="1">1 Traveler</option>
                        <option value="2">2 Travelers</option>
                        <option value="3">3 Travelers</option>
                        <option value="4">4 Travelers</option>
                        <option value="5">5 Travelers</option>
                        <option value="6">6 Travelers</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="name">Full Name</label>
                      <input
                        type="text"
                        name="name"
                        id="name"
                        class="form-control"
                        required=""
                      />
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="email">Email Address</label>
                      <input
                        type="email"
                        name="email"
                        id="email"
                        class="form-control"
                        required=""
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input
                    type="tel"
                    name="phone"
                    id="phone"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="message">Yêu cầu hoặc câu hỏi đặc biệt</label>
                  <textarea
                    name="message"
                    id="message"
                    rows="4"
                    class="form-control"
                    placeholder="Any dietary restrictions, accessibility needs, or special occasions..."
                  ></textarea>
                </div>
                <a href="{% url 'bookings:ticket_detail' 'preview' %}" class="btn-submit">
                  Đặt vé ngay
                </a>
              </form>
            </div>
          </div>
          {% else %}
          <div
            class="booking-section"
            id="booking"
            data-aos="fade-up"
            data-aos-delay="600"
          >
            <div class="booking-card">
              <h2>Book Tour</h2>
              <div class="login-required-message">
                <p>Vui lòng <a href="{% url 'users:login' %}?next={{ request.get_full_path }}">đăng nhập</a> để đặt tour.</p>
                <p>Nếu chưa có tài khoản, <a href="{% url 'users:register' %}">đăng ký ngay</a>.</p>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Gallery -->
          <div class="tour-gallery" data-aos="fade-up" data-aos-delay="700">
            <h2>Photo Gallery</h2>
            <div class="gallery-grid">
              <div class="gallery-item">
                <a
                  href="{% if tour.image %}{{ tour.image.url }}{% else %}{% static 'img/travel/destination-1.webp' %}{% endif %}"
                  class="glightbox"
                >
                  <img
                    src="{% if tour.image %}{{ tour.image.url }}{% else %}{% static 'img/travel/destination-1.webp' %}{% endif %}"
                    alt="{{ tour.name }}"
                    class="img-fluid"
                    loading="lazy"
                  />
                </a>
              </div>
              <div class="gallery-item">
                <a
                  href="{% static 'img/travel/destination-2.webp' %}"
                  class="glightbox"
                >
                  <img
                    src="{% static 'img/travel/destination-2.webp' %}"
                    alt="{{ tour.location }} Experience"
                    class="img-fluid"
                    loading="lazy"
                  />
                </a>
              </div>
              <div class="gallery-item">
                <a
                  href="{% static 'img/travel/destination-3.webp' %}"
                  class="glightbox"
                >
                  <img
                    src="{% static 'img/travel/destination-3.webp' %}"
                    alt="Tour Activities"
                    class="img-fluid"
                    loading="lazy"
                  />
                </a>
              </div>
            </div>
          </div>

          <!-- Related Tours -->
          {% if related_tours %}
          <div class="related-tours" data-aos="fade-up" data-aos-delay="800">
            <h2>Related Tours</h2>
            <div class="row">
              {% for related_tour in related_tours %}
              <div class="col-lg-3 col-md-6 mb-4">
                <div class="tour-card">
                  <div class="tour-image">
                    <img
                      src="{% if related_tour.image %}{{ related_tour.image.url }}{% else %}{% static 'img/travel/tour-15.webp' %}{% endif %}"
                      alt="{{ related_tour.name }}"
                      class="img-fluid"
                    />
                    <div class="tour-price">${{ related_tour.price }}</div>
                  </div>
                  <div class="tour-content">
                    <h4>{{ related_tour.name }}</h4>
                    <p>
                      {{ related_tour.description|truncatewords:15 }}
                    </p>
                    <div class="tour-details">
                      <span><i class="bi bi-clock"></i> {{ related_tour.duration }} Days</span>
                      <span><i class="bi bi-geo-alt"></i> {{ related_tour.location }}</span>
                    </div>
                    <a href="{% url 'tours:tour_detail' related_tour.tour_id %}" class="btn btn-outline-primary">View Details</a>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Final CTA -->
          <div class="final-cta" data-aos="fade-up" data-aos-delay="1000">
            <div class="cta-content">
              <h2>Ready for your {{ tour.name }} adventure?</h2>
              <p>
                Limited spots available for 2024 departures. Book now to secure your place on this amazing journey.
              </p>
              <div class="cta-actions">
                <a href="{% url 'tours:book_tour' tour.tour_id %}" class="btn-primary">Book Now</a>
                <a href="tel:+1-555-123-4567" class="btn-secondary"
                  >Call Us: +1 (555) 123-4567</a
                >
              </div>
              <div class="urgency-banner">
                <i class="bi bi-clock"></i>
                <span>Next departure in 45 days - Only 6 spots left!</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- /Travel Tour Details Section -->
    </main>

    <footer id="footer" class="footer position-relative dark-background">
      <div class="footer-newsletter">
        <div class="container">
          <div class="row justify-content-center text-center">
            <div class="col-lg-6">
              <h4>Join Our Newsletter</h4>
              <p>
                Subscribe to our newsletter and receive the latest news about
                our products and services!
              </p>
              <form
                action="forms/newsletter.php"
                method="post"
                class="php-email-form"
              >
                <div class="newsletter-form">
                  <input type="email" name="email" /><input
                    type="submit"
                    value="Subscribe"
                  />
                </div>
                <div class="loading">Loading</div>
                <div class="error-message"></div>
                <div class="sent-message">
                  Your subscription request has been sent. Thank you!
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="container footer-top">
        <div class="row gy-4">
          <div class="col-lg-4 col-md-6 footer-about">
            <a href="{% url 'core:home' %}" class="d-flex align-items-center">
              <span class="sitename">Tour</span>
            </a>
            <div class="footer-contact pt-3">
              <p>A108 Adam Street</p>
              <p>New York, NY 535022</p>
              <p class="mt-3">
                <strong>Phone:</strong> <span>+1 5589 55488 55</span>
              </p>
              <p><strong>Email:</strong> <span>info@example.com</span></p>
            </div>
          </div>

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><i class="bi bi-chevron-right"></i> <a href="{% url 'core:home' %}">Home</a></li>
              <li>
                <i class="bi bi-chevron-right"></i> <a href="{% url 'core:about' %}">About us</a>
              </li>
              <li>
                <i class="bi bi-chevron-right"></i> <a href="{% url 'tours:tour_list' %}">Tours</a>
              </li>
              <li>
                <i class="bi bi-chevron-right"></i>
                <a href="{% url 'core:terms' %}">Terms of service</a>
              </li>
            </ul>
          </div>

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Our Services</h4>
            <ul>
              <li>
                <i class="bi bi-chevron-right"></i> <a href="{% url 'bookings:booking_list' %}">Booking</a>
              </li>
              <li>
                <i class="bi bi-chevron-right"></i>
                <a href="{% url 'flight:flight_list' %}">Flight</a>
              </li>
              <li>
                <i class="bi bi-chevron-right"></i>
                <a href="{% url 'hotels:hotel_list' %}">Hotels</a>
              </li>
              <li>
                <i class="bi bi-chevron-right"></i> <a href="{% url 'core:contact' %}">Contact</a>
              </li>
            </ul>
          </div>

          <div class="col-lg-4 col-md-12">
            <h4>Follow Us</h4>
            <p>
              Cras fermentum odio eu feugiat lide par naso tierra videa magna
              derita valies
            </p>
            <div class="social-links d-flex">
              <a href=""><i class="bi bi-twitter-x"></i></a>
              <a href=""><i class="bi bi-facebook"></i></a>
              <a href=""><i class="bi bi-instagram"></i></a>
              <a href=""><i class="bi bi-linkedin"></i></a>
            </div>
          </div>
        </div>
      </div>

      <div class="container copyright text-center mt-4">
        <p>
          © <span>Copyright</span>
          <strong class="px-1 sitename">MyWebsite</strong>
          <span>All Rights Reserved</span>
        </p>
        <div class="credits">Designed by <a href="nhóm 7">nhóm 7</a></div>
      </div>
    </footer>

    <!-- Scroll Top -->
    <a
      href="#"
      id="scroll-top"
      class="scroll-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'vendor/php-email-form/validate.js' %}"></script>
    <script src="{% static 'vendor/aos/aos.js' %}"></script>
    <script src="{% static 'vendor/purecounter/purecounter_vanilla.js' %}"></script>
    <script src="{% static 'vendor/swiper/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'vendor/imagesloaded/imagesloaded.pkgd.min.js' %}"></script>
    <script src="{% static 'vendor/glightbox/js/glightbox.min.js' %}"></script>

    <!-- Main JS File -->
    <script src="{% static 'js/main.js' %}"></script>
  </body>
</html>
